@model IEnumerable<YachtCRM.Domain.Project>
@{
    ViewData["Title"] = "Projects";
    var active = (string)(ViewBag.FilterStatus ?? "");
    string btn(string val) => val == active ? "btn btn-sm btn-primary" : "btn btn-sm btn-outline-primary";
    var q = (string)(ViewBag.Query ?? "");
    int? customerId = ViewBag.CustomerId as int?;
}

<h2 class="mb-3">Projects</h2>

<div class="d-flex align-items-center mb-3 gap-2 flex-wrap">
  <a class="@btn("")" asp-action="Index">All</a>
  <a class="@btn("Planning")" asp-action="Index" asp-route-status="Planning" asp-route-q="@q" asp-route-customerId="@customerId">Planning</a>
  <a class="@btn("InProgress")" asp-action="Index" asp-route-status="InProgress" asp-route-q="@q" asp-route-customerId="@customerId">InProgress</a>
  <a class="@btn("Completed")" asp-action="Index" asp-route-status="Completed" asp-route-q="@q" asp-route-customerId="@customerId">Completed</a>
</div>

<form method="get" class="row g-2 mb-3">
  <div class="col-auto">
    <input name="q" value="@q" class="form-control" placeholder="Search projects, customer, model..." />
  </div>
  <input type="hidden" name="status" value="@active" />
  @if (customerId.HasValue)
  {
    <input type="hidden" name="customerId" value="@customerId" />
  }
  <div class="col-auto">
    <button class="btn btn-outline-primary">Filter</button>
    <a asp-action="Index" class="btn btn-outline-secondary ms-2">Clear</a>
  </div>
</form>

@if (!Model.Any())
{
  <div class="alert alert-info">No projects match your filters.</div>
}
else
{
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th style="width:80px;">ID</th>
        <th>Name</th>
        <th>Customer</th>
        <th>Model</th>
        <th class="text-end" style="width:160px;">Total Price</th>
        <th style="width:140px;">Status</th>
        <th style="width:120px;"></th>
      </tr>
    </thead>
    <tbody>
    @foreach (var p in Model)
    {
      <tr>
        <td>@p.ProjectID</td>
        <td class="text-truncate" style="max-width:280px;">@p.Name</td>
        <td class="text-truncate" style="max-width:220px;">@p.Customer?.Name</td>
        <td class="text-truncate" style="max-width:220px;">@p.YachtModel?.ModelName</td>
        <td class="text-end">@p.TotalPrice.ToString("C")</td>
        <td><span class="badge bg-info">@p.Status</span></td>
        <td>
          <a class="btn btn-sm btn-primary" asp-action="Details" asp-route-id="@p.ProjectID">Details</a>
        </td>
      </tr>
    }
    </tbody>
  </table>
}

<p>
  <a class="btn btn-success" asp-action="Create">+ New Project</a>
</p>



